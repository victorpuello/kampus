<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <style>
    @page {
      size: A4;
      margin: 1.5cm;
      @frame footer {
        -pdf-frame-content: footerContent;
        bottom: 0.4cm;
        margin-left: 1.4cm;
        margin-right: 1.4cm;
        height: 0.5cm;
      }
    }

    /* Keep everything on one A4 page where possible */
    body { font-family: Helvetica, Arial, sans-serif; font-size: 12px; color: #111827; line-height: 1.25; margin: 0; padding: 0; }
    .page { -pdf-keep-in-frame-mode: shrink; }

    .masthead { width: 100%; border-collapse: collapse; margin-bottom: 6px; }
    .masthead td { vertical-align: middle; }
    .masthead-left { width: 22%; }
    .masthead-center { width: 56%; text-align: center; }
    .masthead-right { width: 22%; text-align: right; }

    .masthead-logo-wrap { width: 70px; height: 70px; }
    .masthead-logo { max-height: 70px; max-width: 70px; width: auto; height: auto; }

    .inst-line1 { font-size: 14px; font-weight: bold; }
    .inst-line2 { font-size: 12px; }
    .inst-line3 { font-size: 11px; color: #374151; }

    .title { text-align: center; font-size: 14px; font-weight: bold; margin: 5px 0 6px; }
    .subtitle { text-align: center; font-size: 12px; margin-bottom: 6px; }

    .block { margin: 6px 0; line-height: 1.25; }
    .block p { margin: 0; }

    .grades-table { width: 100%; border-collapse: collapse; margin-top: 5px; }
    .grades-table th, .grades-table td { border: 1px solid #d1d5db; padding: 3px; }
    .grades-table th { background: #f3f4f6; font-weight: bold; text-transform: uppercase; font-size: 10px; }
    .grades-table tr { page-break-inside: avoid; }
    .col-area { width: 48%; }
    .col-hours { width: 14%; text-align: center; white-space: nowrap; }
    .col-score { width: 18%; text-align: center; white-space: nowrap; }
    .col-perf { width: 20%; text-align: center; white-space: nowrap; }

    .meta-row { margin-top: 5px; }
    .meta-row strong { display: inline-block; width: 240px; }

    .signature { margin-top: 12px; page-break-inside: avoid; }
    .signature-image { height: 65px; width: auto; display: block; position: relative; top: 10px; }
    .signature-name { margin-top: 0px; font-weight: bold; text-transform: uppercase; }

    .qr-wrap { margin-top: 6px; text-align: right; page-break-inside: avoid; }
    .qr-wrap img { width: 70px; height: 70px; }
    .verify-block { margin-top: 4px; }
    .verify-link { color: #2563eb; text-decoration: underline; font-weight: 700; }
    .verify-url, .verify-token {
      font-family: "Courier New", Courier, monospace;
      font-size: 9px;
      white-space: nowrap;
      word-break: normal;
      overflow-wrap: normal;
      hyphens: none;
    }

    .small { font-size: 10px; color: #374151; }
  </style>
</head>
<body>
  <div class="page">
    {% include "reports/partials/pdf_masthead.html" %}
    <div class="subtitle" style="margin-top: 6px; font-weight: bold;">CERTIFICA</div>
  </div>
  <div class="block">
    Que <strong>{{ student_full_name|upper }}</strong>
    identificado(a) con <strong>{{ document_type }}</strong> No. <strong>{{ document_number }}</strong>
    durante el año lectivo <strong>{{ academic_year }}</strong>
    cursó el grado <strong>{{ grade_name|upper }}</strong>
    {% if academic_level %}de Educación <strong>{{ academic_level|upper }}</strong>{% endif %}
    de acuerdo al Plan de Estudios que establece la Ley 115 de febrero 4 de 1994 y Decreto 1290 del 16 de abril de 2009,
    habiendo obtenido en las diferentes áreas de estudio las siguientes valoraciones:
  </div>

  <table class="grades-table">
    <thead>
      <tr>
        <th class="col-area">ÁREA</th>
        <th class="col-hours">INT. HORARIA</th>
        <th class="col-score">NOTA</th>
        <th class="col-perf">DESEMPEÑO</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
        <tr>
          <td class="col-area">{{ row.area_subject }}</td>
          <td class="col-hours">{% if row.hours_per_week %}{{ row.hours_per_week }} h/sem{% else %}—{% endif %}</td>
          <td class="col-score">{{ row.score }}</td>
          <td class="col-perf">{{ row.performance }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" style="text-align:center; padding: 14px;">No hay áreas configuradas o no hay notas registradas para este grado.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="meta-row"><strong>CONDUCTA:</strong> {{ conduct|default:"BUENA" }}</div>
  <div class="meta-row"><strong>SITUACIÓN ACADÉMICA FINAL:</strong> {{ final_status|default:"APROBADO" }}</div>

  <div class="block" style="margin-top: 12px;">
    El presente <strong>CERTIFICADO</strong> es fiel copia de su original tomada del <strong>LIBRO DE VALORACIONES</strong>.
  </div>

  <div class="block">
    Para mayor constancia se firma en <strong>San Bernardo del Viento, Córdoba </strong> a los {{ issue_date|date:"d" }} días del mes de {{ issue_date|date:"F" }} de {{ issue_date|date:"Y" }}.
  </div>

  <table style="width: 100%; border-collapse: collapse;">
    <tr>
      <td style="width: 68%; vertical-align: top;">
        <div class="signature">
          {% if institution.pdf_rector_signature_image %}
            <img src="{{ institution.pdf_rector_signature_image.url }}" alt="Firma del rector" class="signature-image" />
          {% else %}
            <div style="height: 40px;"></div>
          {% endif %}
          <div class="signature-name">{{ signer_name|upper }}</div>
          <div class="small">{% if signer_role %}{{ signer_role }}{% endif %}</div>
        </div>
      </td>
      <td style="width: 32%; vertical-align: top;">
        <div class="qr-wrap">
          {% if qr_image_src %}
            <img src="{{ qr_image_src }}" alt="QR verificación" />
          {% endif %}
          <div class="small" style="margin-top: 4px;">
            {% if verify_url %}
              <div class="verify-block">
                <div>
                  <span style="font-weight:700;">Verificación:</span>
                  <a class="verify-link" href="{{ verify_url }}">Abrir enlace</a>
                </div>
                {% if verify_url_prefix and verify_token %}
                  <div class="verify-url">{{ verify_url_prefix }}{{ verify_token }}/</div>
                  <div class="small" style="margin-top: 2px;">Código: <span class="verify-token">{{ verify_token }}</span></div>
                {% else %}
                  <div class="verify-url">{{ verify_url }}</div>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </td>
    </tr>
  </table>

  {# Footer text is rendered by reports/partials/pdf_masthead.html to keep it consistent. #}
  </div>
</body>
</html>
